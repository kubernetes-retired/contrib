---
- name: CoreOS | Create docker dropin directory
  file: path=/etc/systemd/system/docker.service.d state=directory mode=0755

- name: CoreOS | Write docker dropin file
  copy: src=10-env-file.conf dest="/etc/systemd/system/docker.service.d/10-env-file.conf"
  register: docker_dropin
  notify:
    - reload systemd

- name: CoreOS | Add any insecure registries to docker config
  lineinfile: dest={{ docker_config_dir }}/docker regexp=^DOCKER_OPTS= line=DOCKER_OPTS="'{% for reg in insecure_registrys %}--insecure-registry={{ reg }}{% endfor %}'"
  when: insecure_registrys is defined and insecure_registrys > 0
  notify:
    - restart docker
