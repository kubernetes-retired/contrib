- name: ensure contiv_bin_dest exists
  file: path={{ contiv_bin_dest }} recurse=yes state=directory

- name: copy netmaster exec file
  copy: src={{ contiv_bin_path }}/netmaster dest={{ contiv_bin_dest }}/netmaster mode=0755

- name: copy netctl exec file
  copy: src={{ contiv_bin_path }}/netctl dest={{ contiv_bin_dest }}/netctl mode=0755

- name: copy netmaster setup script
  template: src=nw_setup.j2 dest={{ contiv_bin_dest }}/nw_setup.sh mode=0755

- name: copy environment file for netmaster
  copy: src=netmaster.env dest=/etc/default/netmaster

- name: copy systemd units for netmaster
  copy: src=netmaster.service dest=/etc/systemd/system/netmaster.service

- name: setup netmaster host alias
  lineinfile: dest=/etc/hosts line="{{ contiv_service_vip }} netmaster"

- name: restart netmaster
  service: name=netmaster state=restarted

- name: wait for netmaster
  pause: seconds=60

- include: aci.yml

- name: configure network
  shell: {{ contiv_bin_dest }}/nw_setup.sh
