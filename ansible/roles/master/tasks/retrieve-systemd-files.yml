---
- name: Install Systemd unit files
  copy: src={{ item }}.service dest=/etc/systemd/system/{{ item }}.service
  register: "{{ item }}_service"
  notify:
    - reload systemd
  with_items:
    - kube-apiserver
    - kube-controller-manager
    - kube-scheduler
    - kubelet

- name: Install Systemd config files
  template: src={{ item }}.j2 dest={{ kube_config_dir }}/{{ item }}
  register: "{{ item }}_default"
  notify:
    - reload systemd
  with_items:
    - apiserver
    - scheduler
    - controller-manager
    - kubelet

- name: Install Systemd tmpfile
  copy: src=kubernetes.conf dest=/usr/lib/tmpfiles.d/kubernetes.conf
  notify:
    - reload systemd
